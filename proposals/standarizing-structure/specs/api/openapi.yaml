# Owner: Dev. API contracts for the project. Human-defined; code and agents implement against this.
openapi: 3.0.3
info:
  title: Template API
  description: API contracts for the project. Human-defined; code and agents implement against this.
  version: 0.1.0

servers:
  - url: https://api.example.com/v1
    description: Production
  - url: http://localhost:3000/v1
    description: Local

tags:
  - name: auth
    description: Authentication
  - name: payments
    description: Payments

paths:
  /auth/register:
    post:
      tags: [auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
      responses:
        '201': { description: User created }
        '400': { description: Validation error or email already exists }
        '409': { description: Email already registered }

  /auth/login:
    post:
      tags: [auth]
      summary: Sign in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200': { description: Success; session cookie or token in response }
        '401': { description: Invalid credentials }

  /auth/logout:
    post:
      tags: [auth]
      summary: Sign out
      security: [{ session: [] }]
      responses:
        '204': { description: Signed out }

  /auth/me:
    get:
      tags: [auth]
      summary: Current user
      security: [{ session: [] }]
      responses:
        '200': { description: User profile }
        '401': { description: Not authenticated }

  /payments:
    post:
      tags: [payments]
      summary: Create a payment
      security: [{ session: [] }]
      parameters:
        - name: Idempotency-Key
          in: header
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount_cents, currency]
              properties:
                amount_cents: { type: integer, minimum: 1 }
                currency: { type: string, length: 3 }
      responses:
        '201': { description: Payment created }
        '400': { description: Validation error }
        '401': { description: Not authenticated }
        '409': { description: Duplicate idempotency key }

    get:
      tags: [payments]
      summary: List my payments
      security: [{ session: [] }]
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200': { description: List of payments }
        '401': { description: Not authenticated }

  /payments/{id}:
    get:
      tags: [payments]
      summary: Get payment by ID
      security: [{ session: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200': { description: Payment details }
        '401': { description: Not authenticated }
        '404': { description: Not found or not owned by user }

components:
  securitySchemes:
    session:
      type: apiKey
      in: cookie
      name: session_id
  schemas:
    User:
      type: object
      properties:
        id: { type: string, format: uuid }
        email: { type: string, format: email }
        created_at: { type: string, format: date-time }
    Payment:
      type: object
      properties:
        id: { type: string, format: uuid }
        amount_cents: { type: integer }
        currency: { type: string }
        status: { type: string, enum: [pending, succeeded, failed, refunded] }
        created_at: { type: string, format: date-time }
